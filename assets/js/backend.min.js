/*!
 * Last modified: 2021/09/03 13:50:24
 * Part of the WordPress plugin Tag Groups
 * Plugin URI: https://chattymango.com/tag-groups/
 * Author: Christoph Amthor
 * License: GNU GENERAL PUBLIC LICENSE, Version 3
*/
function tg_do_ajax(t, a, s) { var e = jQuery("#tg_nonce").val(); jQuery.extend(a, { action: "tg_ajax_manage_groups", nonce: e }), a.tag_groups_start_position = jQuery("#tg_start_position").val(), a.tag_groups_filter_label = jQuery("#filter_label").val(); var n = ""; jQuery("#tg_groups_container").fadeTo(200, .7), jQuery.ajax({ url: t.ajaxurl, data: a, dataType: "text", method: "post", success: function (e) { try { let o = e; (e = e.replace(/[^{]*{/, "{")) !== o && jQuery("#wpfooter").hide(); var l = JSON.parse(e) } catch (r) { return tg_display_error(r.message + "\n\n" + e.toString(), t.isPremium), !1 } var p = l.data, d = l.supplemental.message, c = l.supplemental.nonce, g = t.show_parents || !1; if ("" !== c && jQuery("#tg_nonce").val(c), "success" === p) { var u, h, b = l.supplemental.groups, f = l.supplemental.start_position; "" !== f ? jQuery("#tg_start_position").val(f) : f = a.start_position; var m = l.supplemental.max_number, v = ""; if (l.supplemental.is_filtered ? jQuery("#tg_groups_container").removeClass("ui-sortable").sortable("disable") : jQuery("#tg_groups_container").addClass("ui-sortable").sortable("enable"), m > 0 || l.supplemental.is_filtered) for (var $ in l.supplemental.parents_available ? jQuery(".tg_group_admin_parent").css("display", "block") : jQuery(".tg_group_admin_parent").css("display", "none"), l.supplemental.only_parents && !l.supplemental.is_filtered && (v += tg_html_first_group(s)), b) { var w = b[$]; if (null != w.id) { g && w.is_parent ? (v += '<tr class="tg_sort_tr tg_is_parent" data-position="' + w.position + '">\n', v += "<td>" + w.id + "</td>\n", v += '<td class="tg_label_column">', v += '<span class="dashicons dashicons-networking" title="' + s.tooltip_parent + '"></span> ', v += '<div style="display:inline-block" class="tg_edit_label tg_text tg_truncate" data-position="' + w.position + '" data-label="' + escape_html(w.label) + '">', v += escape_html(w.label) + '<span class="dashicons dashicons-edit tg_pointer" style="display:none;"></span></div></td>\n', v += '<td colspan="2"></td>') : (v += '<tr class="tg_sort_tr" data-position="' + w.position + '">\n', v += "<td>" + w.id + "</td>\n", v += '<td class="tg_label_column"><div class="tg_edit_label tg_text tg_truncate tg_child_label" data-position="' + w.position + '" data-label="' + escape_html(w.label) + '" data-is_child="1">', v += escape_html(w.label) + '<span class="dashicons dashicons-edit tg_pointer" style="display:none;"></span></div></td>\n', l.supplemental.parents_available && (v += '<td class="tg_hide_when_drag"><div class="tg_truncate">' + w.parent_label + "</div></td>\n"), v += '<td class="tg_hide_when_drag"><div class="tg_term_amounts">', "" !== t.tagsurl ? v += '<a href="' + t.tagsurl + "&term-filter=" + w.id + '" title="' + s.tooltip_showtags + '">' + w.amount + "</a>" : v += w.amount + "</span>", v += "</div>", v += "</td>\n"); let y = ""; "" !== t.tagsurl && (y += '<a href="' + t.tagsurl + "&term-filter=" + w.id + '" title="' + s.tooltip_showtags + '"><span class="tg_pointer dashicons dashicons-tag"></span></a> '), "" !== t.postsurl && (y += '<a href="' + t.postsurl + "&post_status=all&tg_filter_posts_value=" + w.id + '" title="' + s.tooltip_showposts + '"><span class="tg_pointer dashicons dashicons-admin-page"></span></a>'), v += y ? '<td class="tg_hide_when_drag">' + y + "</td>\n" : "", v += '<td class="tg_hide_when_drag">', v += '<span class="tg_delete tg_pointer dashicons dashicons-trash" data-position="' + w.position + '" title="' + s.tooltip_delete + '"></span>'; const i=jQuery("#new_group"); if(i.length){const n=i.find(".new_group_pointer.button"); if (!n.length) {const d = jQuery("<span>", {class: "new_group_pointer button", text: s.tooltip_addnew,}); d.on("click", function () {tg_toggle_clear(w.position);}); i.append(d);}} v += "</td>\n", v += '<td class="tg_hide_when_drag">', v += '<div style="overflow:hidden; position:relative; height:20px; clear:both;">', !l.supplemental.is_filtered && w.position > 1 && (v += '<span class="tg_up tg_pointer dashicons dashicons-arrow-up" data-position="' + w.position + '" title="' + s.tooltip_move_up + '"></span>'), v += "</div>", v += '<div style="overflow:hidden; position:relative; height:20px; clear:both;">', !l.supplemental.is_filtered && w.position < m && (v += '<span class="tg_down tg_pointer dashicons dashicons-arrow-down" data-position="' + w.position + '" title="' + s.tooltip_move_down + '"></span>'), v += "</div>", v += "</td>\n", v += "</tr>\n", v += '<tr class="tg_new_group_row" style="display:none;" id="tg_new_' + w.position + '">\n', v += '<td style="display:none;">' + s.newgroup + "</td>\n", v += '<td colspan="5" style="display:none;"><input data-position="' + w.position + '"  placeholder="' + s.placeholder_new + '">', v += '<span class="tg_new_yes dashicons dashicons-yes tg_pointer" data-position="' + w.position + '"></span> <span class="tg_new_no dashicons dashicons-no-alt tg_pointer" data-position="' + w.position + '" onclick="tg_toggle_clear(' + w.position + ')"></span>', v += "</td>\n", v += "</tr>\n" } } else v += tg_html_first_group(s); jQuery("#tg_groups_container").html(v); var _ = "", x = Number(t.items_per_page); for (x < 1 && (x = 1), h = Math.floor(f / x) + 1, max_page = Math.floor((m - 1) / x) + 1, h > 1 ? _ += '<button class="button-secondary tg_pager_button" data-page="' + (h - 1) + '" title="' + s.tooltip_previous + '"><span class="dashicons dashicons-arrow-left-alt2"></span></button>' : _ += '<button class="button-secondary tg_pager_button" disabled><span class="dashicons dashicons-arrow-left-alt2"></span></button>', i = 1; i <= m; i += x)(u = Math.floor(i / x) + 1) == h ? _ += '<button class="tg_reload_button tg_pointer button-secondary" id="tg_groups_reload" title="' + s.tooltip_reload + '"><span class="dashicons dashicons-update"></span></button>' : _ += '<button class="button-secondary tg_pager_button" data-page="' + u + '" title="' + s.tooltip_go_to_page + " " + u + '"><span>' + u + "</span></button>"; h < max_page ? _ += '<button class="button-secondary tg_pager_button" data-page="' + (h + 1) + '" title="' + s.tooltip_next + '"><span class="dashicons dashicons-arrow-right-alt2"></span></button>' : _ += '<button class="button-secondary tg_pager_button" disabled><span class="dashicons dashicons-arrow-right-alt2"></span></button>', jQuery("#tg_pager_container").fadeOut(200, function () { jQuery(this).html(_).fadeIn(400, function () { jQuery("#tg_pager_container_adjuster").css({ height: Number(jQuery("#tg_pager_container").height()) + 10 }) }) }), "" != d ? n += '<div class="notice notice-success"><p>' + d + "</p></div>" : n += "", jQuery("#tg_message_container").fadeTo(200, 0, function () { jQuery(this).html(n).fadeTo(400, 1) }), jQuery("#new_parent").val("") } else "" == d && (d = "Error loading data.", console.log(e)), n += '<div class="notice notice-error"><p>' + d + "</p></div>", jQuery("#tg_message_container").fadeTo(200, 0, function () { jQuery(this).html(n).fadeTo(400, 1) }); jQuery("#tg_groups_container").fadeTo(200, 1) }, error: function (a, s, e) { tg_display_error(a.responseText, t.isPremium) } }) } function tg_html_first_group(t) { let a = '<tr id="tg_new_1">\n'; return a += "<td ></td>\n", a += '<td colspan="4"><input data-position="0" placeholder="' + t.newgroup + '">', a += '<span class="tg_new_yes dashicons dashicons-yes tg_pointer" data-id="1"></span></span>', a += "</td>\n", a += "</tr>\n" } function tg_display_error(t, a) { console.log("[Tag Groups] " + t); let s; message_output = '<tr><td colspan="6"><div class="notice notice-error"><p>Error loading groups. Please check the error description below and read the <a href="' + (s = "https://taxopress.com/docs/list-not-loading-tag-groups/") + '" target="_blank">troublshooting page</a>.<br><br>' + (t = t.replace(/\n/g, "<br>")) + '</p><div clear="both"></div></div></td></tr>', jQuery("#tg_groups_container").fadeTo(200, 0, function () { jQuery(this).html(message_output).fadeTo(400, 1) }).removeClass("ui-sortable").sortable("disable") } function tg_close_textfield(t, a) { var s; let e = t.children(":first").attr("data-position"), n = t.attr("data-is_child"); s = a ? escape_html(t.children(":first").attr("value")) : escape_html(t.children(":first").attr("data-label")), n ? t.replaceWith('<span class="tg_edit_label tg_text tg_child_label" data-position="' + e + '" data-label="' + s + '" data-is_child=1>' + s + ' <span class="dashicons dashicons-edit tg_pointer" style="display:none;"></span></span>') : t.replaceWith('<span class="tg_edit_label tg_text" data-position="' + e + '" data-label="' + s + '">' + s + ' <span class="dashicons dashicons-edit tg_pointer" style="display:none;"></span></span>') } function tg_toggle_clear(t) { var a = jQuery("#tg_new_" + t); a.is(":visible") ? (jQuery("[data-position=" + t + "]").val(""), a.children().fadeOut(300, function () { a.slideUp(600) })) : (jQuery('[id^="tg_new_"]:visible').children().fadeOut(300, function () { jQuery('[id^="tg_new_"]:visible').slideUp(400) }), a.delay(200).slideDown(400, function () { a.children().fadeIn(300), jQuery("[data-position=" + t + "]").trigger("focus") })) } function tg_close_all_textfields() { jQuery(".tg_edit_label_active").each(function () { tg_close_textfield(jQuery(this), !1) }) } function escape_html(t) { return t.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;") }